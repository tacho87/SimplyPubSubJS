!function(e){function t(s){if(i[s])return i[s].exports;var n=i[s]={exports:{},id:s,loaded:!1};return e[s].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),r=s(n);t["default"]=function(e){return window.ReHoard?window.ReHoard:new r["default"](e)}()},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),n=function(){function e(){var t=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];i(this,e),this.production=t}return s(e,[{key:"changeEnviroment",value:function(){var e=!(arguments.length<=0||void 0===arguments[0])&&arguments[0];this.production=e}},{key:"error",value:function(e){this.production||console.error(e)}},{key:"warn",value:function(e){this.production||console.error(e)}},{key:"info",value:function(e){this.production||console.error(e)}},{key:"log",value:function(e){this.production||console.error(e)}},{key:"debug",value:function(e){this.production&&console.error(e)}}]),e}();t["default"]=n},function(e,t,i){"use strict";function s(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.ReHoardPubSub=void 0;var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),u=i(1),a=s(u);t.ReHoardPubSub=function(){function e(t){n(this,e),this.changeSettings(t),this._states={},this._actions_history=[],this._storageName="ReHoard",this._persistanceLoad(),this._willSubscribeWhenAlive=[],this._debug}return o(e,[{key:"changeSettings",value:function(e){this._settings={persistance:{persist:!(!e||!e.persist)&&e.persist,session:!e||!e.session||e.session,timeAlive:e&&e.timeAlive?e.timeAlive:1},undoRedo:!e||!e.undoRedo||e.undoRedo,actionsHistory:!e||!e.actionsHistory||e.actionsHistory,actionsHistoryLimit:e&&e.actionsHistoryLimit?e.actionsHistoryLimit:1e3,typeMutable:!(!e||!e.typeMutable)&&e.typeMutable,production:!(!e||!e.production)&&e.production},this._debug=new a["default"](this._settings.production)}},{key:"dispatch",value:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?"":arguments[2],s=!1;if(!e||!t)return this._debug.error("Null parameters dispatched "),s;if("string"!=typeof i)return this._debug.error("An action must be a string type"),s;if(this._states.hasOwnProperty(e)){var n=this._states[e];this._update(n,e,t,i),this._notifysubscribers(n),s=!0}else this._create(e,t,i),s=!0;return this._persistanceSave(),s}},{key:"subscribeWhenBecomesAlive",value:function(e,t,i){return this._states.hasOwnProperty(e)&&t?this.subscribe(e,t):this._willSubscribeWhenAlive.push({name:e,listener:t,unSubscribeCB:i})}},{key:"subscribe",value:function(e,t){var i=this;if(!this._states.hasOwnProperty(e)||!t)return this._debug.warn(e+" does not exits yet... Cannot subscribe... :("),!1;var s=function(){var s=i._states[e],n=s.subscribers.push({listener:t,unSubscribeCB:void 0});return i._a_history(s,"Listener Subscribed"),{v:{unSubscribe:function(){i._unSubscribe(e,n)}}}}();return"object"===("undefined"==typeof s?"undefined":r(s))?s.v:void 0}},{key:"getCurrentState",value:function(e){var t=!1;if(this._states.hasOwnProperty(e)){var i=this._states[e];this._notifysubscribers(i),t=!0}else this._debug.warn("getCurrentState failed to find state, check your state name");return t}},{key:"deleteState",value:function(e){var t=!1;return this._states.hasOwnProperty(e)?(this._a_history(this._states[e],"State Deleted"),this._persistanceSave(),delete this._states[e],t=!this._states[e]):this._debug.error(e+" does not exits yet... Cannot delete"),t}},{key:"redo",value:function(e){var t=!1;if(this._settings.undoRedo&&e&&this._states.hasOwnProperty(e)){var i=this._states[e];if(i.redoStack.length>0){i.undoStack.push({value:i.value,action:i.actionReference});var s=i.redoStack.pop();i.value=s.value,i.actionReference=s.actionReference,this._a_history(i,"Redo"),this.getCurrentState(e),this._persistanceSave(),t=!0}}return t}},{key:"undo",value:function(e){var t=!1;if(this._settings.undoRedo&&e&&this._states.hasOwnProperty(e)){var i=this._states[e];if(i.undoStack.length>0){i.redoStack.push({value:i.value,action:i.actionReference});var s=i.undoStack.pop();i.value=s.value,i.actionReference=s.actionReference,this._a_history(i,"Undo"),this.getCurrentState(e),this._persistanceSave(),t=!0}}return t}},{key:"_unSubscribe",value:function(e,t){var i=!1;if(this._states.hasOwnProperty(e)&&e&&t){var s=this._states[e];s.subscribers[t-1]=null,this._a_history(s,"unSubcribed"),i=!0}else this._debug.warn(e+" does not exits yet... Cannot unSubcribe... :(");return i}},{key:"_create",value:function(e,t,i){var s=this._states[e]={};s.typeOfElement="undefined"==typeof t?"undefined":r(t),s.name=e,s.value=t,this._willSubscribeWhenAlive.length>0?this._willSubscribeCore(s):s.subscribers=[],s.action=i,this._settings.undoRedo&&(s.undoStack=[],s.redoStack=[]),this._notifysubscribers(s),this._a_history(s,"Created")}},{key:"_update",value:function(e,t,i,s){if(this._settings.typeMutable)e.typeOfElement="undefined"==typeof i?"undefined":r(i);else if(e.typeOfElement!==("undefined"==typeof i?"undefined":r(i)))return void this._debug.error("Error, mutability violated for: "+e.name);this._settings.undoRedo&&(e.undoStack.push({value:e.value,action:e.actionReference}),e.redoStack=[]),e.value=i,e.action=s,this._a_history(e,"Updated")}},{key:"_willSubscribeCore",value:function(e){var t=this,i=this._willSubscribeWhenAlive.filter(function(t){return t.name===e.name});this._willSubscribeWhenAlive=this._willSubscribeWhenAlive.filter(function(e){return i.indexOf(e)<0}),e.subscribers=i.map(function(e){return{listener:e.listener,unSubscribeCB:e.unSubscribeCB}}),e.subscribers.forEach(function(e,i){try{e.unSubscribeCB&&e.unSubscribeCB({unSubscribe:function(){t._unSubscribe(e.name,i)}})}catch(s){t._debug.warn(s)}})}},{key:"_notifysubscribers",value:function(e){if(e&&e.subscribers.length>0){for(var t=0;t<e.subscribers.length;t++)try{e.subscribers[t]&&null!==e.subscribers[t].listener&&e.subscribers[t].listener(e.value)}catch(i){this._debug.warn(e.subscribers[t].listener+" No longer in scope")}this._a_history(e,"Notified Subscribers")}}},{key:"_persistanceSave",value:function(){if(this._settings.persistance.persist){var e=void 0;e=this._settings.persistance.session?sessionStorage:localStorage;try{var t={date:new Date,states:this._states};e.setItem(this._storageName,JSON.stringify(t))}catch(i){console.log(i)}}}},{key:"_persistanceLoad",value:function(){if(this._settings.persistance.persist){var e=void 0;e=this._settings.persistance.session?sessionStorage:localStorage;try{var t=e.getItem(this._storageName);if(t){var i=JSON.parse(t),s=new Date(i.date);s.setDate(s.getDate()+this._settings.timeAlive),s<new Date?e.removeItem(this._storageName):this._states=Object.assign({},i.states)}}catch(n){this._debug.log(n)}}}},{key:"_a_history",value:function(e,t){this._settings.actionsHistory&&(this._actions_history.length>=this._settings.actionsHistoryLimit&&this._actions_history.splice(parseInt(0,parseInt(this._actions_history.length/2))),this._actions_history.push({action:t,state:Object.assign({},e),date:new Date}))}}]),e}()},function(e,t,i){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}}(),r=i(2),o=function(){function e(t){s(this,e),this._reHoardPubSub=new r.ReHoardPubSub(t),window.StateHub=this}return n(e,[{key:"changeSettings",value:function(e){this._reHoardPubSub.changeSettings(e)}},{key:"dispatch",value:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?"":arguments[2];return this._reHoardPubSub.dispatch(e,t,i)}},{key:"subscribe",value:function(e,t){return this._reHoardPubSub.subscribe(e,t)}},{key:"subscribeWhenBecomesAlive",value:function(e,t,i){return this._reHoardPubSub.subscribeWhenBecomesAlive(e,t,i)}},{key:"getCurrentState",value:function(e){return this._reHoardPubSub.getCurrentState(e)}},{key:"deleteState",value:function(e){return this._reHoardPubSub.deleteState(e)}},{key:"redo",value:function(e){return this._reHoardPubSub.redo(e)}},{key:"undo",value:function(e){return this._reHoardPubSub.undo(e)}}]),e}();t["default"]=o}]);